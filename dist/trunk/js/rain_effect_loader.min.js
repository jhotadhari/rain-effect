(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = function(strings) {
  if (typeof strings === 'string') strings = [strings]
  var exprs = [].slice.call(arguments,1)
  var parts = []
  for (var i = 0; i < strings.length-1; i++) {
    parts.push(strings[i], exprs[i] || '')
  }
  parts.push(strings[i])
  return parts.join('')
}

},{}],2:[function(require,module,exports){
(function (global){
"use strict";var _createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),_rainRenderer=require("./rain_effect_loader/rain-renderer"),_rainRenderer2=_interopRequireDefault(_rainRenderer),_raindrops=require("./rain_effect_loader/raindrops"),_raindrops2=_interopRequireDefault(_raindrops),_imageLoader=require("./rain_effect_loader/image-loader"),_imageLoader2=_interopRequireDefault(_imageLoader),_createCanvas=require("./rain_effect_loader/create-canvas"),_createCanvas2=_interopRequireDefault(_createCanvas),_times=require("./rain_effect_loader/times"),_times2=_interopRequireDefault(_times),_random=require("./rain_effect_loader/random");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}var $=(typeof window !== "undefined" ? window['jQuery'] : typeof global !== "undefined" ? global['jQuery'] : null),_=(typeof window !== "undefined" ? window['_'] : typeof global !== "undefined" ? global['_'] : null),RainImage=function(){function e(i){_classCallCheck(this,e),this.enabled=!0,this.el=i,this.el=i,this.$el=$(i),this.updateGeometrie(),this.updateViewport(),this.setCanvas(),this.updateCss(),this.loadTextures()}return _createClass(e,[{key:"updateGeometrie",value:function(){this.dimensions={height:this.$el.outerHeight(),width:this.$el.outerWidth()},this.dimensions.ratio=this.dimensions.height/this.dimensions.width,this.position=this.$el.offset(),this.position.bottom=this.position.top+this.dimensions.height,this.position.right=this.position.left+this.dimensions.width}},{key:"updateViewport",value:function(){this.viewport={},this.viewport.top=$(window).scrollTop(),this.viewport.bottom=this.viewport.top+$(window).height()}},{key:"inView",value:function(e){return e=e||50,this.position.bottom>this.viewport.top-e&&this.position.top<this.viewport.bottom+e}},{key:"setCanvas",value:function(){this.canvas=(0,_createCanvas2.default)(this.dimensions.width,this.dimensions.height),this.$canvas=$(this.canvas),this.$el.after(this.canvas),this.fallback=this.el}},{key:"updateCss",value:function(){var e=document.defaultView.getComputedStyle(this.el,null);this.$canvas.css({float:e.float,margin:e.margin,maxWidth:e.maxWidth,maxHeight:e.maxHeight,height:e.height,width:e.width,border:e.border,verticalAlign:e.verticalAlign}),"none"!==e.display&&this.$canvas.css({display:e.display}),this.$el.css("display","none")}},{key:"loadTextures",value:function(){var e,i=this;if(this.el.srcset){var t=_.map(this.el.srcset.split(",").map(function(e,i){return e.trim().split(" ").map(function(e,i){return 0===i?e:e.indexOf("w")?e.replace("w",""):null})}),function(e,i){return{width:parseInt(e[1]),src:e[0]}}),n=_.filter(t,function(e){return $(window).width()>=e.width});e=n.length<1?_.min(t,function(e){return e.width}).src:_.max(n,function(e){return e.width}).src}else e=this.el.src;$.post(rain_localize.ajaxurl,{action:"rain_thumbnail",srcFull:this.el.src}).done(function(t){(t=$.parseJSON(t)).hasOwnProperty("srcThumbnail")&&(0,_imageLoader2.default)([{name:"foreground",src:t.srcThumbnail},{name:"background",src:e},{name:"dropShine",src:rain_localize.images.dropShine},{name:"dropAlpha",src:rain_localize.images.dropAlpha},{name:"dropColor",src:rain_localize.images.dropColor}]).then(function(e){i.textures=e,i.startRain()})})}},{key:"startRain",value:function(){var e=this;this.raindrops=new _raindrops2.default(this.inView,this.canvas.width,this.canvas.height,window.devicePixelRatio,this.textures.dropAlpha.img,this.textures.dropColor.img,{minR:20,maxR:60,dropletsRate:25,globalTimeScale:.5,trailRate:1.1,spawnArea:[-.3,.3],trailScaleRange:[.2,.35],dropFallMultiplier:.2,collisionBoost:.35,collisionBoostMultiplier:.025}),(0,_times2.default)(80,function(i){e.raindrops.addDrop(e.raindrops.createDrop({x:(0,_random.random)(e.canvas.width),y:(0,_random.random)(e.canvas.height),r:(0,_random.random)(10,20)}))}),this.renderer=new _rainRenderer2.default(this.canvas,this.inView,this.raindrops.canvas,this.textures.foreground.img,this.textures.background.img,this.textures.dropShine.img,{brightness:1,renderShadow:!0,minRefraction:150,maxRefraction:512,alphaMultiply:7,alphaSubtract:3}),this.setupEvents()}},{key:"setupEvents",value:function(){var i=this,t=this;document.addEventListener("scroll",function(e){i.updateGeometrie(),i.updateViewport(),i.renderer.inView=i.inView,i.raindrops.inView=i.inView});var n=_.debounce(function(){t.updateCss()},100);window.addEventListener("resize",n),window.addEventListener("resize",function(e){i.updateGeometrie(),i.updateViewport()}),document.addEventListener("mousemove",function(e){i.setupParallax(e)}),"undefined"!=typeof wp&&wp.customize&&wp.customize.selectiveRefresh&&wp.customize.selectiveRefresh.bind("partial-content-rendered",function(i){!document.contains(t.el)&&t.enabled&&_.each(i.container,function(i,n,a){$(i).find("img.rain-effect").each(function(i){$(this).load(function(){new e(this,i);t.enabled=!1})})})})}},{key:"setupParallax",value:function(e){if(this.inView){var i=(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0),t=e.pageX-this.position.left,n=e.pageY-i;this.renderer.parallaxX=t/this.canvas.width*2-1,this.renderer.parallaxY=n/this.canvas.height*2-1}}}]),e}();$(document).ready(function(){$(window).load(function(){$("img.rain-effect").each(function(e){new RainImage(this)})})});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./rain_effect_loader/create-canvas":3,"./rain_effect_loader/image-loader":5,"./rain_effect_loader/rain-renderer":6,"./rain_effect_loader/raindrops":7,"./rain_effect_loader/random":8,"./rain_effect_loader/times":9}],3:[function(require,module,exports){
"use strict";function createCanvas(e,t){var a=document.createElement("canvas");return a.width=e,a.height=t,a}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=createCanvas;

},{}],4:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _webgl=require("./webgl"),WebGL=_interopRequireWildcard(_webgl);function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function GL(e,t,r,i){this.init(e,t,r,i)}GL.prototype={canvas:null,gl:null,program:null,width:0,height:0,init:function(e,t,r,i){this.canvas=e,this.width=e.width,this.height=e.height,this.gl=WebGL.getContext(e,t),this.program=this.createProgram(r,i),this.useProgram(this.program)},createProgram:function(e,t){return WebGL.createProgram(this.gl,e,t)},useProgram:function(e){this.program=e,this.gl.useProgram(e)},createTexture:function(e,t){return WebGL.createTexture(this.gl,e,t)},createUniform:function(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];WebGL.createUniform.apply(WebGL,[this.gl,this.program,e,t].concat(i))},activeTexture:function(e){WebGL.activeTexture(this.gl,e)},updateTexture:function(e){WebGL.updateTexture(this.gl,e)},draw:function(){WebGL.setRectangle(this.gl,-1,-1,2,2),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}},exports.default=GL;

},{"./webgl":10}],5:[function(require,module,exports){
"use strict";function loadImage(e,n,r){return new Promise(function(o,t){"string"==typeof e&&(e={name:"image"+n,src:e});var a=new Image;e.img=a,a.addEventListener("load",function(t){"function"==typeof r&&r.call(null,a,n),o(e)}),a.src=e.src})}function loadImages(e,n){return Promise.all(e.map(function(e,r){return loadImage(e,r,n)}))}function ImageLoader(e,n){return new Promise(function(r,o){loadImages(e,n).then(function(e){var n={};e.forEach(function(e){n[e.name]={img:e.img,src:e.src}}),r(n)})})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ImageLoader;

},{}],6:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _webgl=require("./webgl"),WebGL=_interopRequireWildcard(_webgl),_glObj=require("./gl-obj"),_glObj2=_interopRequireDefault(_glObj),_imageLoader=require("./image-loader"),_imageLoader2=_interopRequireDefault(_imageLoader),_createCanvas=require("./create-canvas"),_createCanvas2=_interopRequireDefault(_createCanvas);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(a[r]=e[r]);return a.default=e,a}var requireShaderScript=require("glslify"),vertShader=requireShaderScript(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec2 a_position;\n\nvoid main() {\n   gl_Position = vec4(a_position,0.0,1.0);\n}\n"]),fragShader=requireShaderScript(['precision mediump float;\n#define GLSLIFY 1\n\n// textures\nuniform sampler2D u_waterMap;\nuniform sampler2D u_textureShine;\nuniform sampler2D u_textureFg;\nuniform sampler2D u_textureBg;\n\n// the texCoords passed in from the vertex shader.\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_parallax;\nuniform float u_parallaxFg;\nuniform float u_parallaxBg;\nuniform float u_textureRatio;\nuniform bool u_renderShine;\nuniform bool u_renderShadow;\nuniform float u_minRefraction;\nuniform float u_refractionDelta;\nuniform float u_brightness;\nuniform float u_alphaMultiply;\nuniform float u_alphaSubtract;\n\n// alpha-blends two colors\nvec4 blend(vec4 bg,vec4 fg){\n  vec3 bgm=bg.rgb*bg.a;\n  vec3 fgm=fg.rgb*fg.a;\n  float ia=1.0-fg.a;\n  float a=(fg.a + bg.a * ia);\n  vec3 rgb;\n  if(a!=0.0){\n    rgb=(fgm + bgm * ia) / a;\n  }else{\n    rgb=vec3(0.0,0.0,0.0);\n  }\n  return vec4(rgb,a);\n}\n\nvec2 pixel(){\n  return vec2(1.0,1.0)/u_resolution;\n}\n\nvec2 parallax(float v){\n  return u_parallax*pixel()*v;\n}\n\nvec2 texCoord(){\n  return vec2(gl_FragCoord.x, u_resolution.y-gl_FragCoord.y)/u_resolution;\n}\n\n// scales the bg up and proportionally to fill the container\nvec2 scaledTexCoord(){\n  float ratio=u_resolution.x/u_resolution.y;\n  vec2 scale=vec2(1.0,1.0);\n  vec2 offset=vec2(0.0,0.0);\n  float ratioDelta=ratio-u_textureRatio;\n  if(ratioDelta>=0.0){\n    scale.y=(1.0+ratioDelta);\n    offset.y=ratioDelta/2.0;\n  }else{\n    scale.x=(1.0-ratioDelta);\n    offset.x=-ratioDelta/2.0;\n  }\n  return (texCoord()+offset)/scale;\n}\n\n// get color from fg\nvec4 fgColor(float x, float y){\n  float p2=u_parallaxFg*2.0;\n  vec2 scale=vec2(\n    (u_resolution.x+p2)/u_resolution.x,\n    (u_resolution.y+p2)/u_resolution.y\n  );\n\n  vec2 scaledTexCoord=texCoord()/scale;\n  vec2 offset=vec2(\n    (1.0-(1.0/scale.x))/2.0,\n    (1.0-(1.0/scale.y))/2.0\n  );\n\n  return texture2D(u_waterMap,\n    (scaledTexCoord+offset)+(pixel()*vec2(x,y))+parallax(u_parallaxFg)\n  );\n}\n\nvoid main() {\n  vec4 bg=texture2D(u_textureBg,scaledTexCoord()+parallax(u_parallaxBg));\n\n  vec4 cur = fgColor(0.0,0.0);\n\n  float d=cur.b; // "thickness"\n  float x=cur.g;\n  float y=cur.r;\n\n  float a=clamp(cur.a*u_alphaMultiply-u_alphaSubtract, 0.0,1.0);\n\n  vec2 refraction = (vec2(x,y)-0.5)*2.0;\n  vec2 refractionParallax=parallax(u_parallaxBg-u_parallaxFg);\n  vec2 refractionPos = scaledTexCoord()\n    + (pixel()*refraction*(u_minRefraction+(d*u_refractionDelta)))\n    + refractionParallax;\n\n  vec4 tex=texture2D(u_textureFg,refractionPos);\n\n  if(u_renderShine){\n    float maxShine=490.0;\n    float minShine=maxShine*0.18;\n    vec2 shinePos=vec2(0.5,0.5) + ((1.0/512.0)*refraction)* -(minShine+((maxShine-minShine)*d));\n    vec4 shine=texture2D(u_textureShine,shinePos);\n    tex=blend(tex,shine);\n  }\n\n  vec4 fg=vec4(tex.rgb*u_brightness,a);\n\n  if(u_renderShadow){\n    float borderAlpha = fgColor(0.,0.-(d*6.0)).a;\n    borderAlpha=borderAlpha*u_alphaMultiply-(u_alphaSubtract+0.5);\n    borderAlpha=clamp(borderAlpha,0.,1.);\n    borderAlpha*=0.2;\n    vec4 border=vec4(0.,0.,0.,borderAlpha);\n    fg=blend(border,fg);\n  }\n\n  gl_FragColor = blend(bg,fg);\n}\n']),defaultOptions={renderShadow:!1,minRefraction:256,maxRefraction:512,brightness:1,alphaMultiply:20,alphaSubtract:5,parallaxBg:5,parallaxFg:20};function RainRenderer(e,a,r,n,t){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};this.canvas=e,this.inView=a,this.canvasLiquid=r,this.imageShine=i,this.imageFg=n,this.imageBg=t,this.options=Object.assign({},defaultOptions,o),this.init()}RainRenderer.prototype={canvas:null,inView:!1,gl:null,canvasLiquid:null,width:0,height:0,imageShine:"",imageFg:"",imageBg:"",textures:null,programWater:null,programBlurX:null,programBlurY:null,parallaxX:0,parallaxY:0,renderShadow:!1,options:null,init:function(){this.width=this.canvas.width,this.height=this.canvas.height,this.gl=new _glObj2.default(this.canvas,{alpha:!1},vertShader,fragShader);var e=this.gl;this.programWater=e.program,e.createUniform("2f","resolution",this.width,this.height),e.createUniform("1f","textureRatio",this.imageBg.width/this.imageBg.height),e.createUniform("1i","renderShine",null!==this.imageShine),e.createUniform("1i","renderShadow",this.options.renderShadow),e.createUniform("1f","minRefraction",this.options.minRefraction),e.createUniform("1f","refractionDelta",this.options.maxRefraction-this.options.minRefraction),e.createUniform("1f","brightness",this.options.brightness),e.createUniform("1f","alphaMultiply",this.options.alphaMultiply),e.createUniform("1f","alphaSubtract",this.options.alphaSubtract),e.createUniform("1f","parallaxBg",this.options.parallaxBg),e.createUniform("1f","parallaxFg",this.options.parallaxFg),e.createTexture(null,0),this.textures=[{name:"textureShine",img:null===this.imageShine?(0,_createCanvas2.default)(2,2):this.imageShine},{name:"textureFg",img:this.imageFg},{name:"textureBg",img:this.imageBg}],this.textures.forEach(function(a,r){e.createTexture(a.img,r+1),e.createUniform("1i",a.name,r+1)}),this.draw()},draw:function(){this.gl.useProgram(this.programWater),this.gl.createUniform("2f","parallax",this.parallaxX,this.parallaxY),this.updateTexture(),this.gl.draw(),requestAnimationFrame(this.draw.bind(this))},updateTextures:function(){var e=this;this.textures.forEach(function(a,r){e.gl.activeTexture(r+1),e.gl.updateTexture(a.img)})},updateTexture:function(){this.inView&&(this.gl.activeTexture(0),this.gl.updateTexture(this.canvasLiquid))},resize:function(){},get overlayTexture(){},set overlayTexture(e){}},exports.default=RainRenderer;

},{"./create-canvas":3,"./gl-obj":4,"./image-loader":5,"./webgl":10,"glslify":1}],7:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _imageLoader=require("./image-loader"),_imageLoader2=_interopRequireDefault(_imageLoader),_times=require("./times.js"),_times2=_interopRequireDefault(_times),_createCanvas=require("./create-canvas.js"),_createCanvas2=_interopRequireDefault(_createCanvas),_random=require("./random");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _toConsumableArray(t){if(Array.isArray(t)){for(var i=0,e=Array(t.length);i<t.length;i++)e[i]=t[i];return e}return Array.from(t)}var dropSize=64,Drop={x:0,y:0,r:0,spreadX:0,spreadY:0,momentum:0,momentumX:0,lastSpawn:0,nextSpawn:0,parent:null,isNew:!0,killed:!1,shrink:0},defaultOptions={minR:10,maxR:40,maxDrops:900,rainChance:.3,rainLimit:3,dropletsRate:50,dropletsSize:[2,4],dropletsCleaningRadiusMultiplier:.43,raining:!0,globalTimeScale:1,trailRate:1,autoShrink:!0,spawnArea:[-.1,.95],trailScaleRange:[.2,.5],collisionRadius:.65,collisionRadiusIncrease:.01,dropFallMultiplier:1,collisionBoostMultiplier:.05,collisionBoost:1};function Raindrops(t,i,e,r,s,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};this.inView=t,this.width=i,this.height=e,this.scale=r,this.dropAlpha=s,this.dropColor=o,this.options=Object.assign({},defaultOptions,a),this.init()}function _interpolation(t){return Math.pow(t,3)}Raindrops.prototype={dropColor:null,dropAlpha:null,canvas:null,ctx:null,width:0,height:0,inView:null,scale:0,dropletsPixelDensity:1,droplets:null,dropletsCtx:null,dropletsCounter:0,drops:null,dropsGfx:null,clearDropletsGfx:null,textureCleaningIterations:0,lastRender:null,options:null,init:function(){this.canvas=(0,_createCanvas2.default)(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.droplets=(0,_createCanvas2.default)(this.width*this.dropletsPixelDensity,this.height*this.dropletsPixelDensity),this.dropletsCtx=this.droplets.getContext("2d"),this.drops=[],this.dropsGfx=[],this.renderDropsGfx(),this.update()},get deltaR(){return this.options.maxR-this.options.minR},get area(){return this.width*this.height/this.scale},get areaMultiplier(){return Math.sqrt(this.area/786432)},drawDroplet:function(t,i,e){this.drawDrop(this.dropletsCtx,Object.assign(Object.create(Drop),{x:t*this.dropletsPixelDensity,y:i*this.dropletsPixelDensity,r:e*this.dropletsPixelDensity}))},renderDropsGfx:function(){var t=this,i=(0,_createCanvas2.default)(dropSize,dropSize),e=i.getContext("2d");this.dropsGfx=Array.apply(null,Array(255)).map(function(r,s){var o=(0,_createCanvas2.default)(dropSize,dropSize),a=o.getContext("2d");return e.clearRect(0,0,dropSize,dropSize),e.globalCompositeOperation="source-over",e.drawImage(t.dropColor,0,0,dropSize,dropSize),e.globalCompositeOperation="screen",e.fillStyle="rgba(0,0,"+s+",1)",e.fillRect(0,0,dropSize,dropSize),a.globalCompositeOperation="source-over",a.drawImage(t.dropAlpha,0,0,dropSize,dropSize),a.globalCompositeOperation="source-in",a.drawImage(i,0,0,dropSize,dropSize),o}),this.clearDropletsGfx=(0,_createCanvas2.default)(128,128);var r=this.clearDropletsGfx.getContext("2d");r.fillStyle="#000",r.beginPath(),r.arc(64,64,64,0,2*Math.PI),r.fill()},drawDrop:function(t,i){if(this.dropsGfx.length>0){var e=i.x,r=i.y,s=i.r,o=i.spreadX,a=i.spreadY,n=Math.max(0,Math.min(1,(s-this.options.minR)/this.deltaR*.9));n*=1/(.5*(i.spreadX+i.spreadY)+1),t.globalAlpha=1,t.globalCompositeOperation="source-over",n=Math.floor(n*(this.dropsGfx.length-1)),t.drawImage(this.dropsGfx[n],(e-1*s*(o+1))*this.scale,(r-1.5*s*(a+1))*this.scale,2*s*1*(o+1)*this.scale,2*s*1.5*(a+1)*this.scale)}},clearDroplets:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,r=this.dropletsCtx;r.globalCompositeOperation="destination-out",r.drawImage(this.clearDropletsGfx,(t-e)*this.dropletsPixelDensity*this.scale,(i-e)*this.dropletsPixelDensity*this.scale,2*e*this.dropletsPixelDensity*this.scale,2*e*this.dropletsPixelDensity*this.scale*1.5)},clearCanvas:function(){this.ctx.clearRect(0,0,this.width,this.height)},createDrop:function(t){return this.drops.length>=this.options.maxDrops*this.areaMultiplier?null:Object.assign(Object.create(Drop),t)},addDrop:function(t){return!(this.drops.length>=this.options.maxDrops*this.areaMultiplier||null===t)&&(this.drops.push(t),!0)},updateRain:function(t){var i=[];if(this.options.raining)for(var e=this.options.rainLimit*t*this.areaMultiplier,r=0;(0,_random.chance)(this.options.rainChance*t*this.areaMultiplier)&&r<e;){r++;var s=(0,_random.random)(this.options.minR,this.options.maxR,_interpolation),o=this.createDrop({x:(0,_random.random)(this.width/this.scale),y:(0,_random.random)(this.height/this.scale*this.options.spawnArea[0],this.height/this.scale*this.options.spawnArea[1]),r:s,momentum:1+.1*(s-this.options.minR)+(0,_random.random)(2),spreadX:1.5,spreadY:1.5});null!==o&&i.push(o)}return i},clearDrops:function(){this.drops.forEach(function(t){setTimeout(function(){t.shrink=.1+(0,_random.random)(.5)},(0,_random.random)(1200))}),this.clearTexture()},clearTexture:function(){this.textureCleaningIterations=50},updateDroplets:function(t){var i=this;this.textureCleaningIterations>0&&(this.textureCleaningIterations-=1*t,this.dropletsCtx.globalCompositeOperation="destination-out",this.dropletsCtx.fillStyle="rgba(0,0,0,"+.05*t+")",this.dropletsCtx.fillRect(0,0,this.width*this.dropletsPixelDensity,this.height*this.dropletsPixelDensity)),this.options.raining&&(this.dropletsCounter+=this.options.dropletsRate*t*this.areaMultiplier,(0,_times2.default)(this.dropletsCounter,function(t){i.dropletsCounter--,i.drawDroplet((0,_random.random)(i.width/i.scale),(0,_random.random)(i.height/i.scale),_random.random.apply(void 0,_toConsumableArray(i.options.dropletsSize).concat([function(t){return t*t}])))})),this.ctx.drawImage(this.droplets,0,0,this.width,this.height)},updateDrops:function(t){var i=this,e=[];this.updateDroplets(t);var r=this.updateRain(t);e=e.concat(r),this.drops.sort(function(t,e){var r=t.y*(i.width/i.scale)+t.x,s=e.y*(i.width/i.scale)+e.x;return r>s?1:r==s?0:-1}),this.drops.forEach(function(i,r){var s=this;if(!i.killed){if((0,_random.chance)((i.r-this.options.minR*this.options.dropFallMultiplier)*(.1/this.deltaR)*t)&&(i.momentum+=(0,_random.random)(i.r/this.options.maxR*4)),this.options.autoShrink&&i.r<=this.options.minR&&(0,_random.chance)(.05*t)&&(i.shrink+=.01),i.r-=i.shrink*t,i.r<=0&&(i.killed=!0),this.options.raining&&(i.lastSpawn+=i.momentum*t*this.options.trailRate,i.lastSpawn>i.nextSpawn)){var o=this.createDrop({x:i.x+.1*(0,_random.random)(-i.r,i.r),y:i.y-.01*i.r,r:i.r*_random.random.apply(void 0,_toConsumableArray(this.options.trailScaleRange)),spreadY:.1*i.momentum,parent:i});null!==o&&(e.push(o),i.r*=Math.pow(.97,t),i.lastSpawn=0,i.nextSpawn=(0,_random.random)(this.options.minR,this.options.maxR)-2*i.momentum*this.options.trailRate+(this.options.maxR-i.r))}i.spreadX*=Math.pow(.4,t),i.spreadY*=Math.pow(.7,t);var a=i.momentum>0;a&&!i.killed&&(i.y+=i.momentum*this.options.globalTimeScale,i.x+=i.momentumX*this.options.globalTimeScale,i.y>this.height/this.scale+i.r&&(i.killed=!0));var n=(a||i.isNew)&&!i.killed;i.isNew=!1,n&&this.drops.slice(r+1,r+70).forEach(function(e){if(i!=e&&i.r>e.r&&i.parent!=e&&e.parent!=i&&!e.killed){var r=e.x-i.x,o=e.y-i.y;if(Math.sqrt(r*r+o*o)<(i.r+e.r)*(s.options.collisionRadius+i.momentum*s.options.collisionRadiusIncrease*t)){var a=Math.PI,n=i.r,l=e.r,p=a*(n*n),h=a*(l*l),d=Math.sqrt((p+.8*h)/a);d>s.maxR&&(d=s.maxR),i.r=d,i.momentumX+=.1*r,i.spreadX=0,i.spreadY=0,e.killed=!0,i.momentum=Math.max(e.momentum,Math.min(40,i.momentum+d*s.options.collisionBoostMultiplier+s.options.collisionBoost))}}}),i.momentum-=.1*Math.max(1,.5*this.options.minR-i.momentum)*t,i.momentum<0&&(i.momentum=0),i.momentumX*=Math.pow(.7,t),i.killed||(e.push(i),a&&this.options.dropletsRate>0&&this.clearDroplets(i.x,i.y,i.r*this.options.dropletsCleaningRadiusMultiplier),this.drawDrop(this.ctx,i))}},this),this.drops=e},update:function(){if(this.inView){this.clearCanvas();var t=Date.now();null===this.lastRender&&(this.lastRender=t);var i=(t-this.lastRender)/(1/60*1e3);i>1.1&&(i=1.1),i*=this.options.globalTimeScale,this.lastRender=t,this.updateDrops(i)}requestAnimationFrame(this.update.bind(this))}},exports.default=Raindrops;

},{"./create-canvas.js":3,"./image-loader":5,"./random":8,"./times.js":9}],8:[function(require,module,exports){
"use strict";function random(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n?(n=0,e=1):null!==n&&null===e&&(e=n,n=0);var r=e-n;return null===l&&(l=function(n){return n}),n+l(Math.random())*r}function chance(n){return random()<=n}Object.defineProperty(exports,"__esModule",{value:!0}),exports.random=random,exports.chance=chance;

},{}],9:[function(require,module,exports){
"use strict";function times(e,t){for(var s=0;s<e;s++)t.call(this,s)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=times;

},{}],10:[function(require,module,exports){
"use strict";function getContext(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=null;return["webgl","experimental-webgl"].some(function(a){try{t=e.getContext(a,r)}catch(e){}return null!==t}),null===t&&document.body.classList.add("no-webgl"),t}function createProgram(e,r,t){var a=createShader(e,r,e.VERTEX_SHADER),o=createShader(e,t,e.FRAGMENT_SHADER),n=e.createProgram();if(e.attachShader(n,a),e.attachShader(n,o),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS))return error("Error in program linking: "+e.getProgramInfoLog(n)),e.deleteProgram(n),null;var c=e.getAttribLocation(n,"a_position"),T=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,T),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),e.STATIC_DRAW);var u=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,u),e.enableVertexAttribArray(c),e.vertexAttribPointer(c,2,e.FLOAT,!1,0,0),n}function createShader(e,r,t){var a=e.createShader(t);return e.shaderSource(a,r),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)?a:(error("Error compiling shader '"+a+"':"+e.getShaderInfoLog(a)),e.deleteShader(a),null)}function createTexture(e,r,t){var a=e.createTexture();return activeTexture(e,t),e.bindTexture(e.TEXTURE_2D,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),updateTexture(e,r),a}function createUniform(e,r,t,a){for(var o=e.getUniformLocation(r,"u_"+a),n=arguments.length,c=Array(n>4?n-4:0),T=4;T<n;T++)c[T-4]=arguments[T];e["uniform"+t].apply(e,[o].concat(c))}function activeTexture(e,r){e.activeTexture(e["TEXTURE"+r])}function updateTexture(e,r){r&&e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}function setRectangle(e,r,t,a,o){var n=r,c=r+a,T=t,u=t+o;e.bufferData(e.ARRAY_BUFFER,new Float32Array([n,T,c,T,n,u,n,u,c,T,c,u]),e.STATIC_DRAW)}function error(e){console.error(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getContext=getContext,exports.createProgram=createProgram,exports.createShader=createShader,exports.createTexture=createTexture,exports.createUniform=createUniform,exports.activeTexture=activeTexture,exports.updateTexture=updateTexture,exports.setRectangle=setRectangle;

},{}]},{},[2]);
