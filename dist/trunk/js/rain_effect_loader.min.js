!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=function(a){"string"==typeof a&&(a=[a]);for(var b=[].slice.call(arguments,1),c=[],d=0;d<a.length-1;d++)c.push(a[d],b[d]||"");return c.push(a[d]),c.join("")}},{}],2:[function(a,b,c){(function(b){"use strict";function c(a){return a&&a.__esModule?a:{default:a}}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("./rain_effect_loader/rain-renderer"),g=c(f),h=a("./rain_effect_loader/raindrops"),i=c(h),j=a("./rain_effect_loader/image-loader"),k=c(j),l=a("./rain_effect_loader/create-canvas"),m=c(l),n=a("./rain_effect_loader/times"),o=c(n),p=a("./rain_effect_loader/random"),q="undefined"!=typeof window?window.jQuery:void 0!==b?b.jQuery:null,r="undefined"!=typeof window?window._:void 0!==b?b._:null,s=function(){function a(b){d(this,a),this.enabled=!0,this.el=b,this.el=b,this.$el=q(b),this.updateGeometrie(),this.updateViewport(),this.setCanvas(),this.updateCss(),this.loadTextures()}return e(a,[{key:"updateGeometrie",value:function(){this.dimensions={height:this.$el.outerHeight(),width:this.$el.outerWidth()},this.dimensions.ratio=this.dimensions.height/this.dimensions.width,this.position=this.$el.offset(),this.position.bottom=this.position.top+this.dimensions.height,this.position.right=this.position.left+this.dimensions.width}},{key:"updateViewport",value:function(){this.viewport={},this.viewport.top=q(window).scrollTop(),this.viewport.bottom=this.viewport.top+q(window).height()}},{key:"inView",value:function(a){return a=a||50,this.position.bottom>this.viewport.top-a&&this.position.top<this.viewport.bottom+a}},{key:"setCanvas",value:function(){this.canvas=(0,m.default)(this.dimensions.width,this.dimensions.height),this.$canvas=q(this.canvas),this.$el.after(this.canvas),this.fallback=this.el}},{key:"updateCss",value:function(){var a=document.defaultView.getComputedStyle(this.el,null);this.$canvas.css({float:a.float,margin:a.margin,maxWidth:a.maxWidth,maxHeight:a.maxHeight,height:a.height,width:a.width,border:a.border,verticalAlign:a.verticalAlign}),"none"!==a.display&&this.$canvas.css({display:a.display}),this.$el.css("display","none")}},{key:"loadTextures",value:function(){var a,b=this;if(this.el.srcset){var c=r.map(this.el.srcset.split(",").map(function(a,b){return a.trim().split(" ").map(function(a,b){return 0===b?a:a.indexOf("w")?a.replace("w",""):null})}),function(a,b){return{width:parseInt(a[1]),src:a[0]}}),d=r.filter(c,function(a){return q(window).width()>=a.width});a=d.length<1?r.min(c,function(a){return a.width}).src:r.max(d,function(a){return a.width}).src}else a=this.el.src;q.post(rain_localize.ajaxurl,{action:"rain_thumbnail",srcFull:this.el.src}).done(function(c){(c=q.parseJSON(c)).hasOwnProperty("srcThumbnail")&&(0,k.default)([{name:"foreground",src:c.srcThumbnail},{name:"background",src:a},{name:"dropShine",src:rain_localize.images.dropShine},{name:"dropAlpha",src:rain_localize.images.dropAlpha},{name:"dropColor",src:rain_localize.images.dropColor}]).then(function(a){b.textures=a,b.startRain()})})}},{key:"startRain",value:function(){var a=this;this.raindrops=new i.default(this.inView,this.canvas.width,this.canvas.height,window.devicePixelRatio,this.textures.dropAlpha.img,this.textures.dropColor.img,{minR:20,maxR:60,dropletsRate:25,globalTimeScale:.5,trailRate:1.1,spawnArea:[-.3,.3],trailScaleRange:[.2,.35],dropFallMultiplier:.2,collisionBoost:.35,collisionBoostMultiplier:.025}),(0,o.default)(80,function(b){a.raindrops.addDrop(a.raindrops.createDrop({x:(0,p.random)(a.canvas.width),y:(0,p.random)(a.canvas.height),r:(0,p.random)(10,20)}))}),this.renderer=new g.default(this.canvas,this.inView,this.raindrops.canvas,this.textures.foreground.img,this.textures.background.img,this.textures.dropShine.img,{brightness:1,renderShadow:!0,minRefraction:150,maxRefraction:512,alphaMultiply:7,alphaSubtract:3}),this.setupEvents()}},{key:"setupEvents",value:function(){var b=this,c=this;document.addEventListener("scroll",function(a){b.updateGeometrie(),b.updateViewport(),b.renderer.inView=b.inView,b.raindrops.inView=b.inView});var d=r.debounce(function(){c.updateCss()},100);window.addEventListener("resize",d),window.addEventListener("resize",function(a){b.updateGeometrie(),b.updateViewport()}),document.addEventListener("mousemove",function(a){b.setupParallax(a)}),"undefined"!=typeof wp&&wp.customize&&wp.customize.selectiveRefresh&&wp.customize.selectiveRefresh.bind("partial-content-rendered",function(b){!document.contains(c.el)&&c.enabled&&r.each(b.container,function(b,d,e){q(b).find("img.rain-effect").each(function(b){q(this).load(function(){new a(this,b),c.enabled=!1})})})})}},{key:"setupParallax",value:function(a){if(this.inView){var b=(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0),c=a.pageX-this.position.left,d=a.pageY-b;this.renderer.parallaxX=c/this.canvas.width*2-1,this.renderer.parallaxY=d/this.canvas.height*2-1}}}]),a}();q(document).ready(function(){q(window).load(function(){q("img.rain-effect").each(function(a){new s(this)})})})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./rain_effect_loader/create-canvas":3,"./rain_effect_loader/image-loader":5,"./rain_effect_loader/rain-renderer":6,"./rain_effect_loader/raindrops":7,"./rain_effect_loader/random":8,"./rain_effect_loader/times":9}],3:[function(a,b,c){"use strict";function d(a,b){var c=document.createElement("canvas");return c.width=a,c.height=b,c}Object.defineProperty(c,"__esModule",{value:!0}),c.default=d},{}],4:[function(a,b,c){"use strict";function d(a,b,c,d){this.init(a,b,c,d)}Object.defineProperty(c,"__esModule",{value:!0});var e=a("./webgl"),f=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(e);d.prototype={canvas:null,gl:null,program:null,width:0,height:0,init:function(a,b,c,d){this.canvas=a,this.width=a.width,this.height=a.height,this.gl=f.getContext(a,b),this.program=this.createProgram(c,d),this.useProgram(this.program)},createProgram:function(a,b){return f.createProgram(this.gl,a,b)},useProgram:function(a){this.program=a,this.gl.useProgram(a)},createTexture:function(a,b){return f.createTexture(this.gl,a,b)},createUniform:function(a,b){for(var c=arguments.length,d=Array(c>2?c-2:0),e=2;e<c;e++)d[e-2]=arguments[e];f.createUniform.apply(f,[this.gl,this.program,a,b].concat(d))},activeTexture:function(a){f.activeTexture(this.gl,a)},updateTexture:function(a){f.updateTexture(this.gl,a)},draw:function(){f.setRectangle(this.gl,-1,-1,2,2),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}},c.default=d},{"./webgl":10}],5:[function(a,b,c){"use strict";function d(a,b,c){return new Promise(function(d,e){"string"==typeof a&&(a={name:"image"+b,src:a});var f=new Image;a.img=f,f.addEventListener("load",function(e){"function"==typeof c&&c.call(null,f,b),d(a)}),f.src=a.src})}function e(a,b){return Promise.all(a.map(function(a,c){return d(a,c,b)}))}function f(a,b){return new Promise(function(c,d){e(a,b).then(function(a){var b={};a.forEach(function(a){b[a.name]={img:a.img,src:a.src}}),c(b)})})}Object.defineProperty(c,"__esModule",{value:!0}),c.default=f},{}],6:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b,c,d,e){var f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};this.canvas=a,this.inView=b,this.canvasLiquid=c,this.imageShine=f,this.imageFg=d,this.imageBg=e,this.options=Object.assign({},o,g),this.init()}Object.defineProperty(c,"__esModule",{value:!0});var f=a("./webgl"),g=(function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a}(f),a("./gl-obj")),h=d(g),i=a("./image-loader"),j=(d(i),a("./create-canvas")),k=d(j),l=a("glslify"),m=l(["precision mediump float;\n#define GLSLIFY 1\n\nattribute vec2 a_position;\n\nvoid main() {\n   gl_Position = vec4(a_position,0.0,1.0);\n}\n"]),n=l(['precision mediump float;\n#define GLSLIFY 1\n\n// textures\nuniform sampler2D u_waterMap;\nuniform sampler2D u_textureShine;\nuniform sampler2D u_textureFg;\nuniform sampler2D u_textureBg;\n\n// the texCoords passed in from the vertex shader.\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_parallax;\nuniform float u_parallaxFg;\nuniform float u_parallaxBg;\nuniform float u_textureRatio;\nuniform bool u_renderShine;\nuniform bool u_renderShadow;\nuniform float u_minRefraction;\nuniform float u_refractionDelta;\nuniform float u_brightness;\nuniform float u_alphaMultiply;\nuniform float u_alphaSubtract;\n\n// alpha-blends two colors\nvec4 blend(vec4 bg,vec4 fg){\n  vec3 bgm=bg.rgb*bg.a;\n  vec3 fgm=fg.rgb*fg.a;\n  float ia=1.0-fg.a;\n  float a=(fg.a + bg.a * ia);\n  vec3 rgb;\n  if(a!=0.0){\n    rgb=(fgm + bgm * ia) / a;\n  }else{\n    rgb=vec3(0.0,0.0,0.0);\n  }\n  return vec4(rgb,a);\n}\n\nvec2 pixel(){\n  return vec2(1.0,1.0)/u_resolution;\n}\n\nvec2 parallax(float v){\n  return u_parallax*pixel()*v;\n}\n\nvec2 texCoord(){\n  return vec2(gl_FragCoord.x, u_resolution.y-gl_FragCoord.y)/u_resolution;\n}\n\n// scales the bg up and proportionally to fill the container\nvec2 scaledTexCoord(){\n  float ratio=u_resolution.x/u_resolution.y;\n  vec2 scale=vec2(1.0,1.0);\n  vec2 offset=vec2(0.0,0.0);\n  float ratioDelta=ratio-u_textureRatio;\n  if(ratioDelta>=0.0){\n    scale.y=(1.0+ratioDelta);\n    offset.y=ratioDelta/2.0;\n  }else{\n    scale.x=(1.0-ratioDelta);\n    offset.x=-ratioDelta/2.0;\n  }\n  return (texCoord()+offset)/scale;\n}\n\n// get color from fg\nvec4 fgColor(float x, float y){\n  float p2=u_parallaxFg*2.0;\n  vec2 scale=vec2(\n    (u_resolution.x+p2)/u_resolution.x,\n    (u_resolution.y+p2)/u_resolution.y\n  );\n\n  vec2 scaledTexCoord=texCoord()/scale;\n  vec2 offset=vec2(\n    (1.0-(1.0/scale.x))/2.0,\n    (1.0-(1.0/scale.y))/2.0\n  );\n\n  return texture2D(u_waterMap,\n    (scaledTexCoord+offset)+(pixel()*vec2(x,y))+parallax(u_parallaxFg)\n  );\n}\n\nvoid main() {\n  vec4 bg=texture2D(u_textureBg,scaledTexCoord()+parallax(u_parallaxBg));\n\n  vec4 cur = fgColor(0.0,0.0);\n\n  float d=cur.b; // "thickness"\n  float x=cur.g;\n  float y=cur.r;\n\n  float a=clamp(cur.a*u_alphaMultiply-u_alphaSubtract, 0.0,1.0);\n\n  vec2 refraction = (vec2(x,y)-0.5)*2.0;\n  vec2 refractionParallax=parallax(u_parallaxBg-u_parallaxFg);\n  vec2 refractionPos = scaledTexCoord()\n    + (pixel()*refraction*(u_minRefraction+(d*u_refractionDelta)))\n    + refractionParallax;\n\n  vec4 tex=texture2D(u_textureFg,refractionPos);\n\n  if(u_renderShine){\n    float maxShine=490.0;\n    float minShine=maxShine*0.18;\n    vec2 shinePos=vec2(0.5,0.5) + ((1.0/512.0)*refraction)* -(minShine+((maxShine-minShine)*d));\n    vec4 shine=texture2D(u_textureShine,shinePos);\n    tex=blend(tex,shine);\n  }\n\n  vec4 fg=vec4(tex.rgb*u_brightness,a);\n\n  if(u_renderShadow){\n    float borderAlpha = fgColor(0.,0.-(d*6.0)).a;\n    borderAlpha=borderAlpha*u_alphaMultiply-(u_alphaSubtract+0.5);\n    borderAlpha=clamp(borderAlpha,0.,1.);\n    borderAlpha*=0.2;\n    vec4 border=vec4(0.,0.,0.,borderAlpha);\n    fg=blend(border,fg);\n  }\n\n  gl_FragColor = blend(bg,fg);\n}\n']),o={renderShadow:!1,minRefraction:256,maxRefraction:512,brightness:1,alphaMultiply:20,alphaSubtract:5,parallaxBg:5,parallaxFg:20};e.prototype={canvas:null,inView:!1,gl:null,canvasLiquid:null,width:0,height:0,imageShine:"",imageFg:"",imageBg:"",textures:null,programWater:null,programBlurX:null,programBlurY:null,parallaxX:0,parallaxY:0,renderShadow:!1,options:null,init:function(){this.width=this.canvas.width,this.height=this.canvas.height,this.gl=new h.default(this.canvas,{alpha:!1},m,n);var a=this.gl;this.programWater=a.program,a.createUniform("2f","resolution",this.width,this.height),a.createUniform("1f","textureRatio",this.imageBg.width/this.imageBg.height),a.createUniform("1i","renderShine",null!==this.imageShine),a.createUniform("1i","renderShadow",this.options.renderShadow),a.createUniform("1f","minRefraction",this.options.minRefraction),a.createUniform("1f","refractionDelta",this.options.maxRefraction-this.options.minRefraction),a.createUniform("1f","brightness",this.options.brightness),a.createUniform("1f","alphaMultiply",this.options.alphaMultiply),a.createUniform("1f","alphaSubtract",this.options.alphaSubtract),a.createUniform("1f","parallaxBg",this.options.parallaxBg),a.createUniform("1f","parallaxFg",this.options.parallaxFg),a.createTexture(null,0),this.textures=[{name:"textureShine",img:null===this.imageShine?(0,k.default)(2,2):this.imageShine},{name:"textureFg",img:this.imageFg},{name:"textureBg",img:this.imageBg}],this.textures.forEach(function(b,c){a.createTexture(b.img,c+1),a.createUniform("1i",b.name,c+1)}),this.draw()},draw:function(){this.gl.useProgram(this.programWater),this.gl.createUniform("2f","parallax",this.parallaxX,this.parallaxY),this.updateTexture(),this.gl.draw(),requestAnimationFrame(this.draw.bind(this))},updateTextures:function(){var a=this;this.textures.forEach(function(b,c){a.gl.activeTexture(c+1),a.gl.updateTexture(b.img)})},updateTexture:function(){this.inView&&(this.gl.activeTexture(0),this.gl.updateTexture(this.canvasLiquid))},resize:function(){},get overlayTexture(){},set overlayTexture(a){}},c.default=e},{"./create-canvas":3,"./gl-obj":4,"./image-loader":5,"./webgl":10,glslify:1}],7:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a,b,c,d,e,f){var g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};this.inView=a,this.width=b,this.height=c,this.scale=d,this.dropAlpha=e,this.dropColor=f,this.options=Object.assign({},o,g),this.init()}function g(a){return Math.pow(a,3)}Object.defineProperty(c,"__esModule",{value:!0});var h=a("./image-loader"),i=(d(h),a("./times.js")),j=d(i),k=a("./create-canvas.js"),l=d(k),m=a("./random"),n={x:0,y:0,r:0,spreadX:0,spreadY:0,momentum:0,momentumX:0,lastSpawn:0,nextSpawn:0,parent:null,isNew:!0,killed:!1,shrink:0},o={minR:10,maxR:40,maxDrops:900,rainChance:.3,rainLimit:3,dropletsRate:50,dropletsSize:[2,4],dropletsCleaningRadiusMultiplier:.43,raining:!0,globalTimeScale:1,trailRate:1,autoShrink:!0,spawnArea:[-.1,.95],trailScaleRange:[.2,.5],collisionRadius:.65,collisionRadiusIncrease:.01,dropFallMultiplier:1,collisionBoostMultiplier:.05,collisionBoost:1};f.prototype={dropColor:null,dropAlpha:null,canvas:null,ctx:null,width:0,height:0,inView:null,scale:0,dropletsPixelDensity:1,droplets:null,dropletsCtx:null,dropletsCounter:0,drops:null,dropsGfx:null,clearDropletsGfx:null,textureCleaningIterations:0,lastRender:null,options:null,init:function(){this.canvas=(0,l.default)(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.droplets=(0,l.default)(this.width*this.dropletsPixelDensity,this.height*this.dropletsPixelDensity),this.dropletsCtx=this.droplets.getContext("2d"),this.drops=[],this.dropsGfx=[],this.renderDropsGfx(),this.update()},get deltaR(){return this.options.maxR-this.options.minR},get area(){return this.width*this.height/this.scale},get areaMultiplier(){return Math.sqrt(this.area/786432)},drawDroplet:function(a,b,c){this.drawDrop(this.dropletsCtx,Object.assign(Object.create(n),{x:a*this.dropletsPixelDensity,y:b*this.dropletsPixelDensity,r:c*this.dropletsPixelDensity}))},renderDropsGfx:function(){var a=this,b=(0,l.default)(64,64),c=b.getContext("2d");this.dropsGfx=Array.apply(null,Array(255)).map(function(d,e){var f=(0,l.default)(64,64),g=f.getContext("2d");return c.clearRect(0,0,64,64),c.globalCompositeOperation="source-over",c.drawImage(a.dropColor,0,0,64,64),c.globalCompositeOperation="screen",c.fillStyle="rgba(0,0,"+e+",1)",c.fillRect(0,0,64,64),g.globalCompositeOperation="source-over",g.drawImage(a.dropAlpha,0,0,64,64),g.globalCompositeOperation="source-in",g.drawImage(b,0,0,64,64),f}),this.clearDropletsGfx=(0,l.default)(128,128);var d=this.clearDropletsGfx.getContext("2d");d.fillStyle="#000",d.beginPath(),d.arc(64,64,64,0,2*Math.PI),d.fill()},drawDrop:function(a,b){if(this.dropsGfx.length>0){var c=b.x,d=b.y,e=b.r,f=b.spreadX,g=b.spreadY,h=Math.max(0,Math.min(1,(e-this.options.minR)/this.deltaR*.9));h*=1/(.5*(b.spreadX+b.spreadY)+1),a.globalAlpha=1,a.globalCompositeOperation="source-over",h=Math.floor(h*(this.dropsGfx.length-1)),a.drawImage(this.dropsGfx[h],(c-1*e*(f+1))*this.scale,(d-1.5*e*(g+1))*this.scale,2*e*1*(f+1)*this.scale,2*e*1.5*(g+1)*this.scale)}},clearDroplets:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,d=this.dropletsCtx;d.globalCompositeOperation="destination-out",d.drawImage(this.clearDropletsGfx,(a-c)*this.dropletsPixelDensity*this.scale,(b-c)*this.dropletsPixelDensity*this.scale,2*c*this.dropletsPixelDensity*this.scale,2*c*this.dropletsPixelDensity*this.scale*1.5)},clearCanvas:function(){this.ctx.clearRect(0,0,this.width,this.height)},createDrop:function(a){return this.drops.length>=this.options.maxDrops*this.areaMultiplier?null:Object.assign(Object.create(n),a)},addDrop:function(a){return!(this.drops.length>=this.options.maxDrops*this.areaMultiplier||null===a||(this.drops.push(a),0))},updateRain:function(a){var b=[];if(this.options.raining)for(var c=this.options.rainLimit*a*this.areaMultiplier,d=0;(0,m.chance)(this.options.rainChance*a*this.areaMultiplier)&&d<c;){d++;var e=(0,m.random)(this.options.minR,this.options.maxR,g),f=this.createDrop({x:(0,m.random)(this.width/this.scale),y:(0,m.random)(this.height/this.scale*this.options.spawnArea[0],this.height/this.scale*this.options.spawnArea[1]),r:e,momentum:1+.1*(e-this.options.minR)+(0,m.random)(2),spreadX:1.5,spreadY:1.5});null!==f&&b.push(f)}return b},clearDrops:function(){this.drops.forEach(function(a){setTimeout(function(){a.shrink=.1+(0,m.random)(.5)},(0,m.random)(1200))}),this.clearTexture()},clearTexture:function(){this.textureCleaningIterations=50},updateDroplets:function(a){var b=this;this.textureCleaningIterations>0&&(this.textureCleaningIterations-=1*a,this.dropletsCtx.globalCompositeOperation="destination-out",this.dropletsCtx.fillStyle="rgba(0,0,0,"+.05*a+")",this.dropletsCtx.fillRect(0,0,this.width*this.dropletsPixelDensity,this.height*this.dropletsPixelDensity)),this.options.raining&&(this.dropletsCounter+=this.options.dropletsRate*a*this.areaMultiplier,(0,j.default)(this.dropletsCounter,function(a){b.dropletsCounter--,b.drawDroplet((0,m.random)(b.width/b.scale),(0,m.random)(b.height/b.scale),m.random.apply(void 0,e(b.options.dropletsSize).concat([function(a){return a*a}])))})),this.ctx.drawImage(this.droplets,0,0,this.width,this.height)},updateDrops:function(a){var b=this,c=[];this.updateDroplets(a);var d=this.updateRain(a);c=c.concat(d),this.drops.sort(function(a,c){var d=a.y*(b.width/b.scale)+a.x,e=c.y*(b.width/b.scale)+c.x;return d>e?1:d==e?0:-1}),this.drops.forEach(function(b,d){var f=this;if(!b.killed){if((0,m.chance)((b.r-this.options.minR*this.options.dropFallMultiplier)*(.1/this.deltaR)*a)&&(b.momentum+=(0,m.random)(b.r/this.options.maxR*4)),this.options.autoShrink&&b.r<=this.options.minR&&(0,m.chance)(.05*a)&&(b.shrink+=.01),b.r-=b.shrink*a,b.r<=0&&(b.killed=!0),this.options.raining&&(b.lastSpawn+=b.momentum*a*this.options.trailRate,b.lastSpawn>b.nextSpawn)){var g=this.createDrop({x:b.x+.1*(0,m.random)(-b.r,b.r),y:b.y-.01*b.r,r:b.r*m.random.apply(void 0,e(this.options.trailScaleRange)),spreadY:.1*b.momentum,parent:b});null!==g&&(c.push(g),b.r*=Math.pow(.97,a),b.lastSpawn=0,b.nextSpawn=(0,m.random)(this.options.minR,this.options.maxR)-2*b.momentum*this.options.trailRate+(this.options.maxR-b.r))}b.spreadX*=Math.pow(.4,a),b.spreadY*=Math.pow(.7,a);var h=b.momentum>0;h&&!b.killed&&(b.y+=b.momentum*this.options.globalTimeScale,b.x+=b.momentumX*this.options.globalTimeScale,b.y>this.height/this.scale+b.r&&(b.killed=!0));var i=(h||b.isNew)&&!b.killed;b.isNew=!1,i&&this.drops.slice(d+1,d+70).forEach(function(c){if(b!=c&&b.r>c.r&&b.parent!=c&&c.parent!=b&&!c.killed){var d=c.x-b.x,e=c.y-b.y;if(Math.sqrt(d*d+e*e)<(b.r+c.r)*(f.options.collisionRadius+b.momentum*f.options.collisionRadiusIncrease*a)){var g=Math.PI,h=b.r,i=c.r,j=g*(h*h),k=g*(i*i),l=Math.sqrt((j+.8*k)/g);l>f.maxR&&(l=f.maxR),b.r=l,b.momentumX+=.1*d,b.spreadX=0,b.spreadY=0,c.killed=!0,b.momentum=Math.max(c.momentum,Math.min(40,b.momentum+l*f.options.collisionBoostMultiplier+f.options.collisionBoost))}}}),b.momentum-=.1*Math.max(1,.5*this.options.minR-b.momentum)*a,b.momentum<0&&(b.momentum=0),b.momentumX*=Math.pow(.7,a),b.killed||(c.push(b),h&&this.options.dropletsRate>0&&this.clearDroplets(b.x,b.y,b.r*this.options.dropletsCleaningRadiusMultiplier),this.drawDrop(this.ctx,b))}},this),this.drops=c},update:function(){if(this.inView){this.clearCanvas();var a=Date.now();null===this.lastRender&&(this.lastRender=a);var b=(a-this.lastRender)/(1/60*1e3);b>1.1&&(b=1.1),b*=this.options.globalTimeScale,this.lastRender=a,this.updateDrops(b)}requestAnimationFrame(this.update.bind(this))}},c.default=f},{"./create-canvas.js":3,"./image-loader":5,"./random":8,"./times.js":9}],8:[function(a,b,c){"use strict";function d(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===a?(a=0,b=1):null!==a&&null===b&&(b=a,a=0);var d=b-a;return null===c&&(c=function(a){return a}),a+c(Math.random())*d}function e(a){return d()<=a}Object.defineProperty(c,"__esModule",{value:!0}),c.random=d,c.chance=e},{}],9:[function(a,b,c){"use strict";function d(a,b){for(var c=0;c<a;c++)b.call(this,c)}Object.defineProperty(c,"__esModule",{value:!0}),c.default=d},{}],10:[function(a,b,c){"use strict";function d(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=null;return["webgl","experimental-webgl"].some(function(d){try{c=a.getContext(d,b)}catch(a){}return null!==c}),null===c&&document.body.classList.add("no-webgl"),c}function e(a,b,c){var d=f(a,b,a.VERTEX_SHADER),e=f(a,c,a.FRAGMENT_SHADER),g=a.createProgram();if(a.attachShader(g,d),a.attachShader(g,e),a.linkProgram(g),!a.getProgramParameter(g,a.LINK_STATUS))return l("Error in program linking: "+a.getProgramInfoLog(g)),a.deleteProgram(g),null;var h=a.getAttribLocation(g,"a_position"),i=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,i),a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),a.STATIC_DRAW);var j=a.createBuffer();return a.bindBuffer(a.ARRAY_BUFFER,j),a.enableVertexAttribArray(h),a.vertexAttribPointer(h,2,a.FLOAT,!1,0,0),g}function f(a,b,c){var d=a.createShader(c);return a.shaderSource(d,b),a.compileShader(d),a.getShaderParameter(d,a.COMPILE_STATUS)?d:(l("Error compiling shader '"+d+"':"+a.getShaderInfoLog(d)),a.deleteShader(d),null)}function g(a,b,c){var d=a.createTexture();return i(a,c),a.bindTexture(a.TEXTURE_2D,d),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),j(a,b),d}function h(a,b,c,d){for(var e=a.getUniformLocation(b,"u_"+d),f=arguments.length,g=Array(f>4?f-4:0),h=4;h<f;h++)g[h-4]=arguments[h];a["uniform"+c].apply(a,[e].concat(g))}function i(a,b){a.activeTexture(a["TEXTURE"+b])}function j(a,b){b&&a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b)}function k(a,b,c,d,e){var f=b,g=b+d,h=c,i=c+e;a.bufferData(a.ARRAY_BUFFER,new Float32Array([f,h,g,h,f,i,f,i,g,h,g,i]),a.STATIC_DRAW)}function l(a){console.error(a)}Object.defineProperty(c,"__esModule",{value:!0}),c.getContext=d,c.createProgram=e,c.createShader=f,c.createTexture=g,c.createUniform=h,c.activeTexture=i,c.updateTexture=j,c.setRectangle=k},{}]},{},[2]);